<!DOCTYPE html>
<html>
<head>
    <title>HTML to JSON Converter</title>
    <script type="text/javascript">
        function convertHtmlToJson() {
            const htmlString = document.getElementById("inputHtml").value;
            // const jsonOutput = JSON.stringify(convertHtmlStringToJson(htmlString), null, 2);
            // if user selects radio button for MCQ then convert to MCQ else convert to matching
            if(document.getElementById("mcq").checked) {
                const jsonOutput = JSON.stringify(convertMCQHtmlToJson(htmlString), null, 2);
                document.getElementById("jsonOutput").value = jsonOutput;
            } else {
                const jsonOutput = JSON.stringify(convertHtmlStringToJson(htmlString), null, 2);
                document.getElementById("jsonOutput").value = jsonOutput;
            }
        }

        
        function convertHtmlStringToJson(htmlString) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            
            const title = doc.querySelector('h1').innerText;
            const body = Array.from(doc.querySelectorAll('p'))
                .slice(0, 2)
                .map(p => p.innerHTML)
                .join(' ');

            const items = [];
            const itemTitles = doc.querySelectorAll('p:nth-of-type(n+3):nth-of-type(-n+4)');
            const itemOptions = doc.querySelectorAll('ul');
            for (let i = 0; i < itemTitles.length; i++) {
                const options = Array.from(itemOptions[i].querySelectorAll('li'))
                    .map(li => ({ text: li.innerText, _isCorrect: false, _score: 0 }));
                options[0]._isCorrect = true;
                options[0]._score = 1;

                items.push({
                    text: itemTitles[i].innerText,
                    _options: options
                });
            }

            const feedbackParagraphs = Array.from(doc.querySelectorAll('p:nth-of-type(n+5)'));
            const feedbackSplit = feedbackParagraphs[0].innerText.split('/');
            const feedback = {
                title: "Feedback",
                altTitle: "Alt feedback title text",
                correct: feedbackSplit[0] + ' ' + feedbackParagraphs.slice(1).map(p => p.innerText).join(' '),
                _incorrect: {
                    notFinal: "",
                    final: feedbackSplit[1] + ' ' + feedbackParagraphs.slice(1).map(p => p.innerText).join(' ')
                },
                _partlyCorrect: {
                    notFinal: "",
                    final: "This feedback will appear if you answered part of the question correctly."
                }
            };

  return {
    _id: "c-05",
    _parentId: "b-05",
    _type: "component",
    _component: "matching",
    _classes: "",
    _layout: "left",
    title: "Matching",
    displayTitle: title,
    body: body,
    instruction: "Choose an option from each dropdown list and select Submit.",
    ariaQuestion: "Question text specifically for screen readers.",
    _attempts: 1,
    _shouldDisplayAttempts: false,
    _shouldResetAllAnswers: false,
    _isRandom: false,
    _isRandomQuestionOrder: false,
    _questionWeight: 1,
    _canShowModelAnswer: true,
    _canShowFeedback: true,
    _canShowMarking: true,
    _recordInteraction: true,
    placeholder: "Please select an option",
    _allowOnlyUniqueAnswers: false,
    _hasItemScoring: false,
    _items: items,
    _feedback: feedback,
    _comment: "You only need to include _buttons if you want to override the button labels that are set in course.json",
    _buttons: {
      _submit: {
        buttonText: "Submit",
        ariaLabel: "Select here to submit your answer."
      },
      _reset: {
        buttonText: "Reset",
        ariaLabel: ""
      },
      _showCorrectAnswer: {
        buttonText: "Correct Answer",
        ariaLabel: ""
      },
      _hideCorrectAnswer: {
        buttonText: "My Answer",
        ariaLabel: ""
      },
      _showFeedback: {
        buttonText: "Show feedback",
        ariaLabel: ""
      },
      remainingAttemptsText: "attempts remaining",
      remainingAttemptText: "final attempt"
    },
    _pageLevelProgress: {
      _isEnabled: true
    }
  };
}


function convertMCQHtmlToJson(htmlString) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlString, 'text/html');
    
    const title = doc.querySelector('h1').innerText;
    const options = Array.from(doc.querySelector('ul').querySelectorAll('li'))
        .map((li, index) => {
            const isCorrect = li.querySelector('strong') !== null;
            return { 
                text: li.innerText.trim(),
                _shouldBeSelected: isCorrect,
                _isPartlyCorrect: false
            };
        });
        
    const feedbackParagraphs = Array.from(doc.querySelectorAll('p:nth-of-type(n+2)'));
    const feedbackSplit = feedbackParagraphs[0].innerText.split('/');
    const feedback = {
        title: "Feedback",
        altTitle: "Alt feedback title text",
        correct: feedbackSplit[0] + ' ' + feedbackParagraphs.slice(1).map(p => p.innerText).join(' '),
        _incorrect: {
            notFinal: "",
            final: feedbackSplit[1] + ' ' + feedbackParagraphs.slice(1).map(p => p.innerText).join(' ')
        },
        _partlyCorrect: {
            notFinal: "",
            final: "This feedback will appear if you answered the question correctly."
        }
    };
    
    return {
        _id: "why-is-de-important-taster-m2-c-4",
        _parentId: "why-is-de-important-taster-m2-b-4",
        _type: "component",
        _component: "mcq",
        _classes: "",
        _layout: "left",
        title: title,
        displayTitle: title,
        body: "Which of the following options would you consider to be correct?",
        instruction: "Choose one option then select Submit.",
        ariaQuestion: "Question text specifically for screen readers.",
        _attempts: 1,
        _shouldDisplayAttempts: false,
        _isRandom: false,
        _hasItemScoring: false,
        _questionWeight: 1,
        _selectable: 1,
        _canShowModelAnswer: true,
        _canShowFeedback: true,
        _canShowMarking: true,
        _recordInteraction: true,
        _items: options,
        _feedback: feedback,
        _comment: "You only need to include _buttons if you want to override the button labels that are set in course.json",
        _buttons: {
            _submit: {
                buttonText: "Submit",
                ariaLabel: "Select here to submit your answer."
            },
            _reset: {
                buttonText: "Reset",
                ariaLabel: ""
            },
            _showCorrectAnswer: {
                buttonText: "Correct Answer",
                ariaLabel: ""
            },
            _hideCorrectAnswer: {
                buttonText: "My Answer",
                ariaLabel: ""
            },
            _showFeedback: {
                buttonText: "Show feedback",
                ariaLabel: ""
            },
            remainingAttemptsText: "attempts remaining",
            remainingAttemptText: "final attempt"
        },
        _pageLevelProgress: {
            _isEnabled: true
        }
    };
}


// // Example usage:
// const htmlString = "..."  // Replace this with your HTML string.
// const jsonOutput = convertHtmlToJson(htmlString);
// console.log(JSON.stringify(jsonOutput, null, 2));

    </script>
</head>
<body>
    <h1>HTML to JSON Converter</h1>
    <!-- input -->
    <input type="radio" id="matching" name="type" value="matching" checked>
    <label for="matching">Matching</label><br>
    <input type="radio" id="mcq" name="type" value="mcq">
    <label for="mcq">MCQ</label><br>
    <br>
    <h2>Input HTML:</h2>
    <textarea id="inputHtml" rows="20" cols="100"></textarea>
    <br>
    <button onclick="convertHtmlToJson()">Convert</button>
    <h2>Output JSON:</h2>
    <textarea id="jsonOutput" rows="20" cols="100" readonly></textarea>
</body>
</html>
